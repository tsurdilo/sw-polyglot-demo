"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateV1 = exports.createV1 = void 0;
const ajv_1 = __importDefault(require("ajv"));
const uuid_1 = require("uuid");
const cloudevent_1 = require("../cloudevent");
const validation_1 = require("../validation");
const schema_1 = require("./schema");
const ajv = new ajv_1.default({ extendRefs: true });
const isValidAgainstSchema = ajv.compile(schema_1.schemaV1);
function createV1(attributes) {
    const event = Object.assign({ specversion: schema_1.schemaV1.definitions.specversion.const, id: uuid_1.v4(), time: new Date().toISOString() }, attributes);
    return new cloudevent_1.CloudEvent(event);
}
exports.createV1 = createV1;
function validateV1(event) {
    if (!isValidAgainstSchema(event)) {
        throw new validation_1.ValidationError("invalid payload", isValidAgainstSchema.errors);
    }
    return true;
}
exports.validateV1 = validateV1;
